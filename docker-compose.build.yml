version: "3.4"
services:

  mysql:
    ports:
      - "${DEV_MYSQL_PORT}:3306"

  redis:
    build:
      context: ./dockerfile/redis/
      dockerfile: Dockerfile
      # build 镜像名在 docker-compose.yml 定义
      # build 镜像以用于生产环境

  php7:
    build:
      context: ./dockerfile/php-fpm/
      # cache_from:
      #   - khs1994/php-fpm:latest-alpine3.7
      dockerfile: Dockerfile
      # build 时的变量，相当于 Dockerfile 中的 ARG
      # args:
      #   buildno: 1
      #   password: secret
      # labels:
      #   com.khs1994.description: "Extend Official PHP_FPM Docker Image"
      #   com.khs1994.department: "Chinese"
      #   com.khs1994.label-with-empty-value: ""
    environment:
      - APP_ENV=development
      - KHS1994_LNMP_DOCKER_VERSION=${KHS1994_LNMP_DOCKER_VERSION} x86_64 With Build Docker Image
    volumes:
      - ./app:${DEVELOPMENT_LNMP_PHP_PATH}:rw
      - ./config/php/php-development.ini:/usr/local/etc/php/php.ini:ro
      - ./config/php/php/conf.d/xdebug.ini:/usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini:ro

  # memcached:
  #   build:
  #     context: ./dockerfile/memcached/
  #     dockerfile: Dockerfile
  #
  # rabbitmq:
  #   build:
  #     context: ./dockerfile/rabbitmq/
  #     dockerfile: Dockerfile
  #
  # postgresql:
  #   build:
  #     context: ./dockerfile/postgresql/
  #     dockerfile: Dockerfile

  nginx:
    build:
      context: ./dockerfile/nginx/
      dockerfile: Dockerfile
    volumes:
      - ./app:${DEVELOPMENT_LNMP_PHP_PATH}:rw

  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    restart: always
    networks:
      - backend
    environment:
      - PMA_HOST=mysql
    ports:
      - 8080:80
    volumes:
      - phpmyadmin-data:/sessions

volumes:
  phpmyadmin-data:
