version: "3.5"

services:
  #
  # docker-compose.yml 文件是为了方便本地测试构建镜像
  #
  # 避免使用 docker build -t ... 命令
  #
  #
  # $ docker-compose build
  #

  nginx:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - NGINX_VERSION=${NGINX_VERSION}
      target: nginx
    image: khs1994/nginx:swarm-${NGINX_VERSION}-alpine
    depends_on:
      - 7_2_X
      # - 7_1_X
      # - 7_0_X
      # - 5_6_X

  #
  # 项目使用哪个 PHP 版本就保留哪个服务，其他注释
  #
  7_2_X:
    build:
      context: .
      dockerfile: Dockerfile
      target: php
      args:
        - PHP_VERSION=${PHP_VERSION_7_2_X}-alpine3.7
    image: khs1994/php-fpm:swarm-${PHP_VERSION_7_2_X}-alpine3.7

#  7_1_X:
#    build:
#      context: .
#      dockerfile: Dockerfile
#      target: nginx
#      args:
#        - PHP_VERSION=${PHP_VERSION_7_1_X}-alpine3.4
#    image: khs1994/php-fpm:swarm-${PHP_VERSION_7_1_X}-alpine3.4
#
#  7_0_X:
#    build:
#      context: .
#      dockerfile: Dockerfile
#      target: nginx
#      args:
#        - PHP_VERSION=${PHP_VERSION_7_0_X}-alpine3.4
#    image: khs1994/php-fpm:swarm-${PHP_VERSION_7_0_X}-alpine3.4
#
#  5_6_X:
#    build:
#      context: .
#      dockerfile: Dockerfile
#      target: nginx
#      args:
#        - PHP_VERSION=${PHP_VERSION_5_6_X}-alpine3.4
#    image: khs1994/php-fpm:swarm-${PHP_VERSION_5_6_X}-alpine3.4
