version: "3.4"
services:

  redis:
    build:
      context: ./dockerfile/redis/
      dockerfile: Dockerfile
    # 镜像推送到私有仓库,以用于生产环境
    image: "${REGISTRY_URL_AND_USERNAME}/redis:${KHS1994_LNMP_REDIS_VERSION}-alpine"

  php7:
    build:
      context: ./dockerfile/php-fpm/
      # build 时的变量，相当于 Dockerfile 中的 ENV
      args:
        buildno: 1
        password: secret
      labels:
        com.khs1994.description: "Extend Official PHP_FPM Docker Image"
        com.khs1994.department: "Chinese"
        com.khs1994.label-with-empty-value: ""
    image: ${REGISTRY_URL_AND_USERNAME}/php-fpm:${KHS1994_LNMP_PHP_VERSION}-alpine3.6

  memcached:
    build:
      context: ./dockerfile/memcached/
    image: ${REGISTRY_URL_AND_USERNAME}/memcached:${KHS1994_LNMP_MEMCACHED_VERSION}-alpine

  rabbitmq:
    build:
      context: ./dockerfile/rabbitmq/
    image: ${REGISTRY_URL_AND_USERNAME}/rabbitmq:${KHS1994_LNMP_RABBITMQ_VERSION}-management-alpine

  postgresql:
    build:
      context: ./dockerfile/postgresql/
    image: ${REGISTRY_URL_AND_USERNAME}/postgres:${KHS1994_LNMP_POSTGRESQL_VERSION}-alpine

  nginx:
    build:
      context: ./dockerfile/nginx/
    image: "${REGISTRY_URL_AND_USERNAME}/nginx:${KHS1994_LNMP_NGINX_VERSION}-alpine"
